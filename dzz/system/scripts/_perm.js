/*
 * @copyright   Leyun internet Technology(Shanghai)Co.,Ltd
 * @license     http://www.dzzoffice.com/licenses/license.txt
 * @package     DzzOffice
 * @link        http://www.dzzoffice.com
 * @author      zyx(zyx@dzz.cc)
 */
_explorer.isPower=function(e,r){var o={flag:1,read1:2,read2:4,delete1:8,delete2:16,edit1:32,edit2:64,download1:128,download2:256,copy1:512,copy2:1024,upload:2048,folder:8192,share:262144};return!(parseInt(o[r])<1)&&(e&parseInt(o[r]))>0},_explorer.FolderSPower=function(e,r){var o={delete:1,folder:2,link:4,upload:8,document:16,dzzdoc:32,app:64,widget:128,user:256,shortcut:512,discuss:1024,download:2048};return"copy"==r&&(r="delete"),parseInt(o[r])<1||(e&parseInt(o[r]))!=parseInt(o[r])},_explorer.FileSPower=function(e,r){var o={delete:1,edit:2,rename:4,move:8,download:16,share:32,widget:64,wallpaper:128,cut:256,shortcut:512};return"copy"==r&&(r="delete"),parseInt(o[r])<1||(e&parseInt(o[r]))!=parseInt(o[r])},_explorer.getFidByContainer=function(e){return-1!==e.indexOf("icosContainer_body_")?_explorer.space.typefid.desktop:"taskbar_dock"==e?_explorer.space.typefid.dock:"_dock"==e?_explorer.space.typefid.dock:-1!==e.indexOf("icosContainer_folder_")?e.replace("icosContainer_folder_",""):void 0},_explorer.getContainerByFid=function(e){var r="";for(var o in _explorer.space.typefid)e==_explorer.space.typefid[o]&&(r=o);return"dock"==r?"_dock":"desktop"==r?"icosContainer_body_"+_layout.fid:"icosContainer_folder_"+e},_explorer.Permission_Container=function(e,r){if(!_explorer.sourcedata.folder[r])return!1;var o=_explorer.sourcedata.folder[r].perm,t=_explorer.sourcedata.folder[r].fsperm,d=_explorer.sourcedata.folder[r].gid;if(!_explorer.FolderSPower(t,e))return!1;if(_explorer.space.uid<1)return!1;if(d>0)return"admin"==e?_explorer.space.self>1||_explorer.sourcedata.folder[r].ismoderator>0:("rename"==e?e="delete":"multiselect"==e?e="copy":jQuery.inArray(e,["link","dzzdoc","newtype"])>-1&&(e="upload"),jQuery.inArray(e,["read","delete","edit","download","copy"])>-1&&(_explorer.myuid==_explorer.sourcedata.folder[r].uid?e+="1":e+="2"),_explorer.isPower(o,e));if("admin"==e||"multiselect"==e){if(_explorer.space.uid==_explorer.sourcedata.folder[r].uid)return!0;if(_explorer.sourcedata.folder[r].bz)return!0}return"rename"==e?e="delete":jQuery.inArray(e,["link","dzzdoc","newtype"])>-1&&(e="upload"),jQuery.inArray(e,["read","delete","edit","download","copy"])>-1&&(_explorer.myuid==_explorer.sourcedata.folder[r].uid?e+="1":e+="2"),_explorer.isPower(o,e)},_explorer.Permission=function(e,r){if(_explorer.myuid<1)return!1;if(r.isdelete>0)return!0;var o=r.pfid,t=r.sperm;if("download"==e){if("document"!=r.type&&"attach"!=r.type&&"image"!=r.type&&"folder"!=r.type)return!1}else if("copy"==e){if("recycle"==r.flag)return!1;if("app"==r.type||"storage"==r.type||"pan"==r.type||"ftp"==r.type)return!1}else if("paste"==e){if(_explorer.cut.icos.length<1)return!1;e=_explorer.sourcedata.icos[_explorer.cut.icos[0]].type}else{if("chmod"==e)return!(!r.bz||"ftp"!=r.bz.split(":")[0]);if("rename"==e){if(o==_explorer.space.typefid.dock)return!1;if("folder"==r.type&&r.bz&&("ALIOSS"==r.bz.split(":")[0]||"qiniu"==r.bz.split(":")[0]))return!1;e="delete"}else"multiselect"==e?e="copy":"drag"==e&&(e=r.gid>0?"copy":"admin")}return!!_explorer.FileSPower(t,e)&&(jQuery.inArray(e,["read","delete","edit","download","copy"])>-1&&(_explorer.myuid==r.uid?e+="1":e+="2"),_explorer.Permission_Container(e,o))},_explorer.Permission_Container_write=function(e,r){if(!_explorer.sourcedata.folder[e])return!1;var o=_explorer.sourcedata.folder[e].fsperm,t=_explorer.sourcedata.folder[e].gid,d=r;if(jQuery.inArray(r,["folder","link","dzzdoc","shortcut","video"])<0&&(d="newtype"),!_explorer.FolderSPower(o,d))return!1;if(_explorer.myuid<1)return!1;if(t>0){if(_explorer.space.self>1||_explorer.sourcedata.folder[e].ismoderator>0)return!0}else{if(_explorer.myuid==_explorer.sourcedata.folder[e].uid)return!0;if(_explorer.sourcedata.folder[e].bz)return!0}return _explorer.Permission_Container(d,e)};