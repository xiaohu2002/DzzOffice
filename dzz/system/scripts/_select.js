/*
 * @copyright   Leyun internet Technology(Shanghai)Co.,Ltd
 * @license     http://www.dzzoffice.com/licenses/license.txt
 * @package     DzzOffice
 * @link        http://www.dzzoffice.com
 * @author      zyx(zyx@dzz.cc)
 */
function _select(e){this.id=this.name=e,this.string="_select.icos."+this.id,this.board=document.getElementById(e),_select.icos[this.id]=this}_select.delay=500,_select.width=120,_select.height=120,_select.icos={},_select.onmousemove=null,_select.onmouseup=null,_select.tach=null,_select.onselectstart=1,_select.init=function(e){var t=new _select(e);return jQuery(t.board).on("mousedown",function(e){var c=(e=e||window.event).srcElement?e.srcElement:e.target;return!!/input|textarea/i.test(c.tagName)||(2==e.button||(dfire("mousedown"),t.Mousedown(e||window.event),!0))}),jQuery(t.board).on("mouseup",function(e){var c=(e=e||window.event).srcElement?e.srcElement:e.target;return!!/input|textarea/i.test(c.tagName)||(dfire("mouseup"),t.Mouseup(e||window.event),!0)}),t},_select.prototype.DetachEvent=function(e){if(_select.tach){document.onmousemove=_select.onmousemove,document.onmouseup=_select.onmouseup,document.onselectstart=_select.onselectstart;try{this.board.releaseCapture&&this.board.releaseCapture()}catch(e){}_select.tach=0,_select.finishblank=0}},_select.prototype.AttachEvent=function(e){if(!_select.tach){_select.onmousemove=document.onmousemove,_select.onmouseup=document.onmouseup,_select.onselectstart=document.onselectstart;try{document.onselectstart=function(){return!1},e.preventDefault?e.preventDefault():this.board.setCapture&&this.board.setCapture()}catch(e){}_select.tach=1}},_select.prototype.Duplicate=function(){this.copy=document.createElement("div"),document.body.appendChild(this.copy),this.copy.style.cssText="position:absolute;left:0px;top:0px;width:0px;height:0px;filter:Alpha(opacity=50);opacity:0.5;z-index:10002;overflow:hidden;background:#000;border:1px solid #000;"},_select.prototype.Mousedown=function(e){if(this.mousedowndoing=!1,"touchstart"==e.type)var t=e.touches[0].clientX,c=e.touches[0].clientY;else t=e.clientX,c=e.clientY;_select.oldxx=t,_select.oldyy=c,this.tl=t,this.tt=c,this.oldx=t,this.oldy=c;var o=this;_select.tach||this.AttachEvent(e),"touchstart"==e.type?jQuery(this.board).on("touchmove",function(e){return o.Move(e),!1}):document.onmousemove=function(e){return o.Move(e||window.event),!1}},_select.prototype.Mouseup=function(e){_select.tach&&this.DetachEvent(e),this.mousedowndoing&&this.Moved(e)},_select.prototype.PreMove=function(e){if(jQuery("#_blank").empty().show(),"no"!=this.move){this.Duplicate();var t=this;this.mousedowndoing=!0;jQuery(this.board).offset();this.copy.style.left=this.tl+"px",this.copy.style.top=this.tt+"px",_hotkey.ctrl>0&&_selectfile.selectall.container==this.id||(_selectfile.selectall.container&&jQuery("#"+_selectfile.selectall.container).find(".Icoblock").removeClass("Icoselected"),_selectfile.selectall.container=this.id,_selectfile.selectall.icos=[],_selectfile.selectall.position={}),jQuery(this.board).find(".Icoblock").each(function(){var e=jQuery(this),t=e.offset(),c=e.attr("rid");c&&(_selectfile.selectall.position[c]={icoid:c,left:t.left,top:t.top,width:e.width(),height:e.height()})}),"touchmove"==e.type?jQuery(this.board).on("touchend",function(e){return t.Moved(e),!0}):document.onmouseup=function(e){return t.Moved(e||window.event),!1}}},_select.prototype.Move=function(e){if("touchmove"===e.type)var t=e.touches[0].clientX,c=e.touches[0].clientY;else t=e.clientX,c=e.clientY;if(!this.mousedowndoing&&(Math.abs(this.oldx-t)>5||Math.abs(this.oldy-c)>5)&&this.PreMove(e),this.mousedowndoing){t-this.oldx>0?this.copy.style.width=t-this.oldx+"px":(this.copy.style.width=Math.abs(t-this.oldx)+"px",this.copy.style.left=this.tl+(t-this.oldx)+"px"),c-this.oldy>0?this.copy.style.height=c-this.oldy+"px":(this.copy.style.height=Math.abs(c-this.oldy)+"px",this.copy.style.top=this.tt+(c-this.oldy)+"px"),BROWSER.ie||(t>this.oldx&&c>this.oldy?(Math.abs(t-_select.oldxx)>20||Math.abs(c-_select.oldyy)>20)&&(_select.oldxx=t,_select.oldyy=c,this.setSelected(!0)):(Math.abs(t-_select.oldxx)>20||Math.abs(c-_select.oldyy)>20)&&(_select.oldxx=t,_select.oldyy=c,this.setSelected()))}},_select.prototype.Moved=function(e){if(jQuery("#_blank").hide(),_select.tach&&this.DetachEvent(e),"touchend"==e.type)var t=e.changedTouches[0].clientX,c=e.changedTouches[0].clientY;else t=e.clientX,c=e.clientY;BROWSER.ie&&(t>this.oldx&&c>this.oldy?this.setSelected(!0):this.setSelected()),jQuery(this.copy).remove()},_select.prototype.setSelected=function(e){_select.sum++;var t=jQuery(this.copy).offset(),c={left:t.left,top:t.top,width:jQuery(this.copy).width(),height:jQuery(this.copy).height()};for(var o in _selectfile.selectall.position){var s=_selectfile.selectall.position[o];_select.checkInArea(c,s,e)?_select.SelectedStyle(this.id,o,!0,!0):_hotkey.ctrl<1&&_select.SelectedStyle(this.id,o,!1,!0)}},_select.checkInArea=function(e,t,c){var o={minx:0,miny:0,maxx:0,maxy:0};return o.minx=Math.max(t.left,e.left),o.miny=Math.max(t.top,e.top),o.maxx=Math.min(t.left+t.width,e.left+e.width),o.maxy=Math.min(t.top+t.height,e.top+e.height),!(o.minx>o.maxx||o.miny>o.maxy)},_select.SelectedStyle=function(e,t,c,o){var s=_selectfile.selectall.icos||[],i=e.split("-"),l=(parseInt(i[2]),e.replace("filemanage-","")),n=jQuery("#"+e).find(".Icoblock[rid="+t+"]");if(c)""==_selectfile.selectall.container&&(_selectfile.selectall.container=e),o&&_selectfile.selectall.container==e?jQuery.inArray(t,_selectfile.selectall.icos)<0&&_selectfile.selectall.icos.push(t):(jQuery("#"+_selectfile.selectall.container).find(".Icoblock").removeClass("Icoselected"),_selectfile.selectall.container=e,_selectfile.selectall.icos=[t],_selectfile.selectall.position={}),n.addClass("Icoselected");else{var r=[];if(_selectfile.selectall.container==e)for(var a in s)s[a]!=t&&r.push(s[a]);_selectfile.selectall.icos=r,n.removeClass("Icoselected")}_selectfile.cons[l]&&_selectfile.cons[l].selectInfo(),_explorer.type&&_selectfile.changefileName(t)},_select.Cut=function(e){if(_config.cut.iscut>0&&_config.cut.icos.length>0)for(var t in _config.cut.icos)jQuery(".Icoblock[icoid="+_config.cut.icos[t]+"]").removeClass("iscut");for(var t in _config.cut.iscut=1,jQuery.inArray(e,_config.selectall.icos)>-1?_config.cut.icos=_config.selectall.icos:_config.cut.icos=[e],_config.cut.icos)jQuery(".Icoblock[rid="+_config.cut.icos[t]+"]").addClass("iscut")},_select.Copy=function(e){if(_config.cut.iscut>0&&_config.cut.icos.length>0)for(var t in _config.cut.icos)jQuery(".Icoblock[icoid="+_config.cut.icos[t]+"]").removeClass("iscut");_config.cut.iscut=0,jQuery.inArray(e,_config.selectall.icos)>-1?_config.cut.icos=_config.selectall.icos:_config.cut.icos=[e]},_select.Paste=function(e,t,c){if(!(_config.cut.icos.length<1)){var o=_config.sourcedata.folder[e].bz||"";if(o)var s=encodeURIComponent(_config.sourcedata.folder[e].path);else s=e;if(_config.sourcedata.icos[_config.cut.icos[0]].bz&&""!=_config.sourcedata.icos[_config.cut.icos[0]].bz){for(var i=[],l=0;l<_config.cut.icos.length;l++)i.push(_config.sourcedata.icos[_config.cut.icos[l]].dpath);var n={obz:_config.sourcedata.icos[_config.cut.icos[0]].bz,tbz:o,sourcetype:"icoid",icoid:i.join(","),ticoid:0,container:"icosContainer_folder_"+s,iscut:_config.cut.iscut>0?1:2}}else{for(i=[],l=0;l<_config.cut.icos.length;l++)i.push(_config.sourcedata.icos[_config.cut.icos[l]].dpath);n={obz:"",tbz:o,sourcetype:"icoid",icoid:i.join(","),ticoid:0,container:"icosContainer_folder_"+s,iscut:_config.cut.iscut>0?1:2}}_config.getContainerByFid(e);showmessage("<p>"+__lang.file_drag_processing+'</p><div class="progress progress-striped active" style="margin:0"><div class="bar" style="width:100%;"></div></div>',"success",0,1,"right-bottom"),jQuery.getJSON(_config.saveurl+"&do=move&"+jQuery.param(n),function(e){if("success"==e.msg){for(var t in _config.cut.icos=[],_config.cut.successicos=[],_config.cut.osuccessicos=[],e.successicos)_config.cut.successicos.push(e.successicos[t]),_config.cut.osuccessicos.push(t);for(var c in e.iscopy>0?showmessage(__lang.file_copy_success,"success",3e3,1,"right-bottom"):(showmessage(__lang.crop_files_success,"success",3e3,1,"right-bottom"),_select.remove(_config.cut.osuccessicos)),e.icoarr)_config.sourcedata.icos[e.icoarr[c].icoid]=e.icoarr[c];for(var c in e.folderarr)_config.sourcedata.folder[e.folderarr[c].fid]=e.folderarr[c];_ico.appendIcoids(_config.cut.successicos),e.error&&showmessage(__lang.operate_files_error,"error",3e3,1,"right-bottom")}else showmessage(__lang.operate_files_error,"error",3e3,1,"right-bottom")})}},_select.remove=function(e){for(var t=0;t<e.length;t++)_ico.removeIcoid(e[t])};