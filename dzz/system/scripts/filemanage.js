/*
 * @copyright   Leyun internet Technology(Shanghai)Co.,Ltd
 * @license     http://www.dzzoffice.com/licenses/license.txt
 * @package     DzzOffice
 * @link        http://www.dzzoffice.com
 * @author      zyx(zyx@dzz.cc)
 */
"use strict";function _filemanage(e,a,i){var t=isNaN(parseInt(i.page))?1:parseInt(i.page),r=isNaN(parseInt(i.total))?1:parseInt(i.total);this.total=r,this.bz=i.bz||"",this.perpage=i.perpage,this.totalpage=Math.ceil(this.total/this.perpage),this.totalpage=this.totalpage<1?1:this.totalpage,this.id=e,this.string="_filemanage.cons."+this.id;var s=e.split("-");"f"==s[0]?this.fid=s[1]:this.fid=0,this.subfix=s[0],this.winid=e,this.keyword=i.keyword,this.localsearch=i.localsearch,this.view=isNaN(parseInt(i.view))?_filemanage.view:parseInt(i.view),this.disp=isNaN(parseInt(i.disp))?_filemanage.disp:parseInt(i.disp),this.asc=i.asc,this.detailper=_filemanage.detailper,this.data||(this.data={}),this.data=a,this.currentpage=t,this.container=i.container,this.odata=[],this.sum=0,_filemanage.cons[this.id]=this,_filemanage.fid=this.fid,_filemanage.subfix=this.subfix,_filemanage.winid=this.id,this.pageloadding=!0,this.exts=i.exts||"",this.tags=i.tags||"",this.before=i.before||"",this.after=i.after||"",this.fids=i.fids||"",this.gid=i.gid||""}_filemanage.selectall={position:{},container:"",icos:[]},_filemanage.saveurl="index.php?mod=system&op=save",_filemanage.speed=5,_filemanage.perpage=100,_filemanage.cons={},_filemanage.view=4,_filemanage.disp=0,_filemanage.asc=1,_filemanage.detailper=[47,10,20,15,8],_filemanage.onmousemove=null,_filemanage.onmouseup=null,_filemanage.onselectstart=1,_filemanage.stack_data={},_filemanage.showicosTimer={},_filemanage.apicacheTimer={},_filemanage.infoPanelUrl="",_filemanage.viewstyle=["bigicon","middleicon","middlelist","smalllist","detaillist"],_filemanage.getData=function(e,a){jQuery.getJSON(e,function(i){if(i.error)return alert(i.error),!1;for(var t in i.data)_explorer.sourcedata.icos[t]=i.data[t];for(var r in i.folderdata)_explorer.sourcedata.folder[r]=i.folderdata[r];_explorer.topMenu(null,_filemanage.fid);var s=null;i.param.page>1?((s=_filemanage.cons[i.sid]).appendIcos(i.data),s.total=parseInt(i.total),s.totalpage=Math.ceil(s.total/s.perpage)):(s=new _filemanage(i.sid,i.data,i.param),_filemanage.selectall.container!=="filemanage-"+i.sid&&(_filemanage.selectall={position:{},container:"",icos:[]},s.selectInfo()),s.showIcos()),s.url=e,jQuery(".sizeMenu .icons-thumbnail").attr("iconview",s.view).find(".dzz").removeClass("dzz-view-module").removeClass("dzz-view-list").addClass(2===s.view?"dzz-view-list":"dzz-view-module"),jQuery(".sizeMenu .icons-thumbnail").attr("iconview",s.view).find(".dzz").attr("data-bs-original-title",2===s.view?__lang.deltail_lsit:__lang.medium_icons),jQuery(".sizeMenu .icons-thumbnail").attr("folderid",s.id),"function"==typeof a&&a(s)})},_filemanage.glow=function(e){for(var a=0;a<4;a++)window.setTimeout(function(){e.find(".toggleGlow").toggleClass("glow")},200*a)},_filemanage.Arrange=function(e,a,i){var t=jQuery(e);a||(a=t.attr("folderid"));var r=_filemanage.cons[a];if(i?i*=1:i=parseInt(t.attr("iconview"))<4?4:2,jQuery(".sizeMenu .icons-thumbnail").attr("iconview",i).find(".dzz").removeClass("dzz-view-module").removeClass("dzz-view-list").addClass(2===i?"dzz-view-list":"dzz-view-module"),jQuery(".sizeMenu .icons-thumbnail").attr("iconview",i).find(".dzz").attr("data-bs-original-title",2===i?__lang.deltail_lsit:__lang.medium_icons),"f"===r.subfix){var s=_filemanage.fid;s>0&&_explorer.Permission_Container("admin",s)&&(jQuery.post(_filemanage.saveurl+"&do=folder",{fid:s,iconview:i}),_explorer.sourcedata.folder[s].iconview=i)}else"cat"===r.subfix?jQuery.post(_filemanage.saveurl+"&do=catsearch",{catid:a.replace("cat-",""),iconview:i}):"search"===r.subfix?jQuery.post(_filemanage.saveurl+"&do=search",{iconview:i}):"recycle"===r.subfix&&jQuery.post(_filemanage.saveurl+"&do=recycle",{iconview:i});r.view=i,r.showIcos(),jQuery("#right_contextmenu .menu-icon-iconview").each(function(){1*jQuery(this).attr("view")==1*i?jQuery(this).removeClass("dzz-check-box-outline-blank").addClass("dzz-check-box"):jQuery(this).addClass("dzz-check-box-outline-blank").removeClass("dzz-check-box")})},_filemanage.Disp=function(e,a,i){var t=_filemanage.cons[a];if("f"===t.subfix){var r=t.fid;r>0&&_explorer.Permission_Container("admin",r)&&jQuery.post(_filemanage.saveurl+"&do=folder",{fid:r,disp:parseInt(i)}),_explorer.sourcedata.folder[r].disp=parseInt(i)}else"cat"===t.subfix&&jQuery.post(_filemanage.saveurl+"&do=catsearch",{catid:a.replace("cat-",""),disp:parseInt(i)});1*i==1*t.disp&&(t.asc=t.asc>0?0:1),t.disp=parseInt(i),0===t.bz.indexOf("ALIOSS")||0===t.bz.indexOf("JSS")?t.showIcos():t.pageClick(1),jQuery("#right_contextmenu .menu-icon-disp").each(function(){1*jQuery(this).attr("disp")==1*i?(jQuery(this).removeClass("dzz-check-box-outline-blank").addClass("dzz-check-box"),jQuery(this).next().find(".caret").removeClass("asc").removeClass("desc").addClass(t.asc>0?"asc":"desc")):(jQuery(this).addClass("dzz-check-box-outline-blank").removeClass("dzz-check-box"),jQuery(this).next().find(".caret").removeClass("asc").removeClass("desc"))})},_filemanage.searchsubmit=function(e){var a=document.getElementById("searchInput_"+e).value;a=a===__lang.search?a:"";var i=_filemanage.cons[e];i&&(i.localsearch?(i.keyword=a,i.showIcos()):i.pageClick(1))},_filemanage.setInfoPanel=function(){var e=_filemanage.selectall.icos;if(_explorer.infoRequest&&(_explorer.infoRequest.abort(),_filemanage.infoPanelUrl=""),_explorer.infoPanelOpened&&!_explorer.infoPanel_hide)if(e.length<1){var a=_filemanage.fid||$("#fidinput").val();if(!a){var i='<div class="nothing_message"><div class="nothing_allimg"><img src="dzz/explorer/img/noFilePage-FileChoice.png"><p>'+__lang.choose_file_examine_information+"</p></div></div>";return $("#rightMenu").html(i),_filemanage.infoPanelUrl="",!1}_filemanage.infoPanelUrl!==a&&(_explorer.infoRequest=$.post(MOD_URL+"&op=dynamic&do=getfolderdynamic",{fid:a},function(e){$("#rightMenu").html(e),_filemanage.infoPanelUrl=a}))}else if(1===e.length)_filemanage.infoPanelUrl!==e[0]&&(_explorer.infoRequest=$.post(MOD_URL+"&op=dynamic&do=getfiledynamic",{rid:e},function(a){$("#rightMenu").html(a),_filemanage.infoPanelUrl=e[0]}));else{var t=e.join(",");_filemanage.infoPanelUrl!==t&&(_explorer.infoRequest=$.post(MOD_URL+"&op=dynamic&do=getfiledynamic",{rid:e},function(e){$("#rightMenu").html(e),_filemanage.infoPanelUrl=t}))}},_filemanage.prototype.CreateIcos=function(e,a){var i=this,t="filemanage-"+this.winid;if(a||!this.data[e.rid]){this.data[e.rid]=e;var r=_filemanage.get_template(this.id);e.flag?(e.img||(e.img="dzz/styles/thame/"+_explorer.thame.system.folder+"/system/"+e.flag+".png"),e.error="dzz/images/default/system/"+e.flag+".png"):"folder"===e.type?e.gid>0?(e.icon=e.img?e.img:e.icon,e.error=e.icon||"dzz/images/default/system/folder-read.png",e.img=e.icon?e.icon.replace("dzz/images/default","dzz/styles/thame/"+_explorer.thame.system.folder):"dzz/styles/thame/"+_explorer.thame.system.folder+"/system/folder-read.png"):(e.icon=e.img?e.img:e.icon,e.error=e.icon||"dzz/images/default/system/folder.png",e.img=e.icon?e.icon.replace("dzz/images/default","dzz/styles/thame/"+_explorer.thame.system.folder):"dzz/styles/thame/"+_explorer.thame.system.folder+"/system/folder.png"):"shortcut"===e.type&&"folder"===e.ttype?e.tdata.gid>0?(e.error=e.tdata.img||"dzz/images/default/system/folder-read.png",e.img=(e.tdata.img+"").replace("dzz/images/default","dzz/styles/thame/"+_explorer.thame.system.folder)):(e.error=e.tdata.img||"dzz/images/default/system/folder.png",e.img=e.tdata.img?(e.tdata.img+"").replace("dzz/images/default","dzz/styles/thame/"+_explorer.thame.system.folder):"dzz/styles/thame/"+_explorer.thame.system.folder+"/system/folder.png"):e.error="dzz/images/default/icodefault.png";var s=r.replace(/\{name\}/g,e.name);if(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s.replace(/\{rid\}/g,e.rid)).replace(/tsrc=\"\{img\}\"/g,'src="{img}"')).replace(/\{img\}/g,e.img)).replace(/\{username\}/g,e.username)).replace(/\{replynum\}/g,e.replynum?e.replynum:"0")).replace(/\{zIndex\}/g,10)).replace(/\{error\}/g,e.error)).replace(/\{size\}/g,"folder"===e.type||"app"===e.type||"shortcut"===e.type?"":e.fsize)).replace(/\{fsize\}/g,e.fsize)).replace(/\{type\}/g,e.type)).replace(/\{ftype\}/g,e.ftype)).replace(/\{dateline\}/g,e.dateline)).replace(/\{fdateline\}/g,e.fdateline)).replace(/\{flag\}/g,e.flag)).replace(/\{position\}/g,e.relpath)).replace(/\{dpath\}/g,e.dpath)).replace(/\{from\}/g,e.from)).replace(/\{delusername\}/g,e.username)).replace(/\{deldateline\}/g,e.deldateline)).replace(/\{finallydate\}/g,e.finallydate)).replace(/\{views\}/g,e.views)).replace(/\{times\}/g,e.times)).replace(/\{downs\}/g,e.downs)).replace(/\{expireday\}/g,e.expireday)).replace(/\{sharelink\}/g,e.sharelink)).replace(/dsrc=\"\{qrcode\}\"/g,'src="{qrcode}"')).replace(/dsrc='\{qrcode\}'/g,"src='{qrcode}'")).replace(/\{qrcode\}/g,e.qrcode)).replace(/\{password\}/g,e.password)).replace(/\{count\}/g,e.count),e.status<0)var l='<span  style="color: red;">('+e.fstatus+")</span>";else l="";if(e.collect)var o='<a href="javascript:;" class="dzz-colllection-item" ><i class="dzz dzz-star" title=""></i></a>';else o='<a href="javascript:;" class="dzz-colllection-item hide"><i class="dzz dzz-star" title=""></i></a>';s=(s=s.replace(/\{collectstatus\}/g,o)).replace(/\{sharestatus\}/g,l),"image"!==e.type&&(s=s.replace(/data-start=\"image\".+?data-end=\"image\"/gi,""));var n="";n=e.gid>0?e.pfid>0?"#group&do=file&gid="+e.gid+"&fid="+e.pfid:"#group&gid="+e.gid:"#home&do=file&fid="+e.pfid,s=s.replace(/\{position_hash\}/g,n);var c=null;a&&jQuery(".Icoblock[rid="+e.rid+"]").length>0?(jQuery(".Icoblock[rid="+e.rid+"]").replaceWith(s),c=jQuery(".Icoblock[rid="+e.rid+"]")):(jQuery(s).appendTo("#"+t+" .js-file-item-tpl"),c=jQuery(".Icoblock[rid="+e.rid+"]"),jQuery("#shareinfo_"+e.rid).on("click",function(e){return!1})),this.view<4?(c.on("mouseenter",function(){jQuery(this).addClass("hover")}),c.on("mouseleave",function(){jQuery(this).removeClass("hover")}),c.find(".icoblank_rightbottom").on("click",function(){var e=!0,a=jQuery(this).parent(),t=a.attr("rid");return a.hasClass("Icoselected")&&(e=!1),_select.SelectedStyle("filemanage-"+i.id,t,e,!0),!1}),c.on("click",function(e){var a=e.srcElement?e.srcElement:e.target;if(/input|textarea/i.test(a.tagName))return!0;var t=jQuery(this).closest(".Icoblock"),r=t.attr("rid"),s=!0;(_hotkey.ctrl&&t.hasClass("Icoselected")||t.hasClass("Icoselected")&&1===_filemanage.selectall.icos.length&&_filemanage.selectall.icos[0]===r)&&(s=!1);var l=!!_hotkey.ctrl;return _select.SelectedStyle("filemanage-"+i.id,jQuery(this).attr("rid"),s,l),!1}),0==this.total&&0==jQuery("#"+t).find(".emptyPage").length?jQuery(jQuery("#template_nofile_notice").html()).appendTo(jQuery("#"+t)):jQuery("#"+t).find(".emptyPage").remove()):(c.bind("mouseenter",function(){jQuery(this).addClass("hover")}),c.bind("mouseleave",function(){jQuery(this).removeClass("hover")}),c.find(".selectbox").on("click",function(){var e=!0,a=jQuery(this).closest(".Icoblock"),t=a.attr("rid");return a.hasClass("Icoselected")&&(e=!1),_select.SelectedStyle("filemanage-"+i.id,t,e,!0),!1})),jQuery.inArray(e.rid,_filemanage.selectall.icos)>-1&&c.addClass("Icoselected"),a||(_filemanage.glow(c),this.sum++,this.total++,jQuery("#"+t+" .scroll-y").scrollTop(9999999),this.currentdata["icos_"+e.rid]=e),0==this.total&&0==jQuery("#"+t).find(".emptyPage").length?jQuery(jQuery("#template_nofile_notice").html()).appendTo(jQuery("#"+t)):jQuery("#"+t).find(".emptyPage").remove()}else{var d=jQuery("#"+t+" .Icoblock[rid="+e.rid+"]");_filemanage.glow(d)}},_filemanage.prototype.showIcos=function(e){var a=this;_filemanage.showicosTimer[this.winid]&&window.clearTimeout(_filemanage.showicosTimer[this.winid]);var i="filemanage-"+this.winid;jQuery("#"+i).empty(),this.createIcosContainer();var t=null;for(var r in this.keyword?(t=_filemanage.Sort(_filemanage.Search(this.data,this.keyword),this.disp,this.asc),jQuery("#searchInput_"+this.id).val(this.keyword)):t=_filemanage.Sort(this.data,this.disp,this.asc),e&&(t=_file.Searchext(t,e)),this.currentdata=t,_filemanage.stack_data[a.id]=Array(),t)_filemanage.stack_data[a.id].push({data:t[r],obj:a});window.setTimeout(function(){_filemanage.stack_run(a.id)},1),this.pageloadding=!1},_filemanage.prototype.appendIcos=function(e){var a=this;for(var i in _filemanage.showicosTimer[this.winid]&&window.clearTimeout(_filemanage.showicosTimer[this.winid]),_filemanage.stack_data[a.winid]=Array(),e)_filemanage.stack_data[a.winid].push({data:e[i],obj:a});window.setTimeout(function(){_filemanage.stack_run(a.winid)},1),this.pageloadding=!1},_filemanage.prototype.createIcosContainer=function(){var e=this,a="filemanage-"+this.id,i=document.getElementById(a);if(i){i.className="icosContainer",i.setAttribute("unselectable","on"),i.setAttribute("onselectstart","return event.srcElement.type== 'text';");i.innerHTML=_filemanage.get_template(this.id,!0),_explorer.Scroll($(".scroll-y"));var t=jQuery(i);t.find(".js-file-item-tpl").empty(),jQuery(".middlecenter,.middle-recycle,.share-content").on("contextmenu",function(a){var i=(a=a||window.event).srcElement?a.srcElement:a.target;return!!/input|textarea/i.test(i.tagName)||(_contextmenu.right_body(a,e.fid),!1)}).on("click",function(i){var r=(i=i||window.event).srcElement?i.srcElement:i.target;if(/input|textarea/i.test(r.tagName))return!0;a===_filemanage.selectall.container&&(_filemanage.selectall.container=a,_filemanage.selectall.icos=[],_filemanage.selectall.position={},t.find(".Icoblock").removeClass("Icoselected"),t.find(".selectall-box").removeClass("Icoselected"),e.selectInfo())}).end().find(".selectall-box").on("click",function(){var i=jQuery(this),t=!0;return i.hasClass("Icoselected")?(i.removeClass("Icoselected"),t=!1,_filemanage.selectall.icos=[]):(i.addClass("Icoselected"),t=!0,_filemanage.selectall.icos=[]),_filemanage.selectall.container=a,jQuery("#"+a).find(".Icoblock").each(function(){t?(jQuery(this).addClass("Icoselected"),_filemanage.selectall.icos.push(jQuery(this).attr("rid"))):jQuery(this).removeClass("Icoselected")}),e.selectInfo(),!1}),jQuery(document).off("click.cselect").on("click.cselect",".dzz-backing-out",function(){-1!=location.hash.indexOf("share")&&jQuery(".deatisinfo").each(function(){jQuery(this).addClass("hide")}),jQuery(".navtopheader").css("display","none"),t.find(".Icoblock").removeClass("Icoselected"),_filemanage.selectall.icos=[],_filemanage.setInfoPanel()}),_select.init(a),this.view<4||jQuery("#"+a).find(".detail_header:not(.detail_header_select)").on("click",function(){var a=parseInt(jQuery(this).attr("disp"));1*a==1*e.disp?e.asc>0?e.asc=0:e.asc=1:(_filemanage.Disp(this,e.id,a),e.asc=1),e.disp=a,e.fid&&(_explorer.sourcedata.folder[e.fid].disp=a),0===e.bz.indexOf("ALIOSS")||0===e.bz.indexOf("JSS")?e.showIcos():e.pageClick(1)}),t.closest(".scroll-srcollbars").scroll(function(){var a=jQuery(this);if(a.height()+a.scrollTop()>=a.children().first().height()){if(e.currentpage>=e.totalpage||e.pageloadding)return;e.pageloadding=!0,e.currentpage++,e.pageClick(e.currentpage)}}),this.fid&&$.getScript(MOD_PATH+"/js/uplodfile.js",function(){jQuery(".wangpan-upload-file").each(function(){fileupload(jQuery(this),e.fid)})}),this.total<1&&0==jQuery("#"+a).find(".emptyPage").length?jQuery(jQuery("#template_nofile_notice").html()).appendTo(i):jQuery("#"+a).find(".emptyPage").remove()}},_filemanage.prototype.selectInfo=function(){var e=this;this.selectinfoTimer&&window.clearTimeout(this.selectinfoTimer),this.selectinfoTimer=window.setTimeout(function(){e._selectInfo()},200)},_filemanage.prototype.pageClick=function(e){var a=this;this.pageloadding=!0,e||(e=1),this.currentpage=e;var i=jQuery("#searchInput_"+this.id).value;i&&i!==__lang.search||(i="");var t=a.url.replace(/&disp\=\d/gi,"").replace(/&asc\=\d/gi,"").replace(/&iconview\=\d/gi,"").replace(/&page\=\d+/gi,"").replace(/&exts\=[\w,]*(&|$)/gi,"&").replace(/&tags\=[\w,]*(&|$)/gi,"&").replace(/&keyword\=\w*(&|$)/,"&").replace(/&fid\=\w*(&|$)/,"&").replace(/&gid\=\w*(&|$)/,"&").replace(/&before\=\w*(&|$)/,"&").replace(/&after\=\w*(&|$)/,"&").replace(/&marker\=\w*(&|$)/,"&").replace(/&t\=\d+/,"");t=t.replace(/&+$/gi,""),_filemanage.getData(t+"&exts="+this.exts+"&tags="+this.tags+"&disp="+this.disp+"&fids="+this.fids+"&gid="+this.gid+"&before="+this.before+"&after="+this.after+"&asc="+this.asc+"&iconview="+this.view+"&keyword="+encodeURI(i)+"&page="+e+"&marker="+(this.fid?_explorer.sourcedata.folder[this.fid].nextMarker:"")+"&t="+(new Date).getTime(),function(){a.PageInfo()})},_filemanage.stack_run=function(e){if(_filemanage.stack_data[e].length>0){_filemanage.stack_data[e][0].obj;for(var a=0;a<_filemanage.speed&&_filemanage.stack_data[e].length>0;a++)_filemanage.stack_data[e][0].obj.CreateIcos(_filemanage.stack_data[e][0].data,1),_filemanage.stack_data[e].splice(0,1);_filemanage.showicosTimer[e]=window.setTimeout(function(){_filemanage.stack_run(e)},1)}else jQuery(document).trigger("showIcos_done")},_filemanage.prototype.tddrager_start=function(e){this.XX=e.clientX,document.getElementById("_blank").style.cursor="e-resize",jQuery("#_blank").show(),this.AttachEvent(e),eval("document.onmousemove=function(e){"+this.string+".tddraging(e?e:window.event);};"),eval("document.onmouseup=function(e){"+this.string+".tddraged(e?e:window.event);};")},_filemanage.prototype.tddraging=function(){document.body.style.cursor="e-resize"},_filemanage.prototype.tddraged=function(e){this.DetachEvent(e),jQuery("#_blank").hide();var a=e.clientX-this.XX,i=_window.windows[this.winid].bodyWidth-jQuery("#jstree_area").width(),t=i*this.detailper[this.tddrager_disp]/100,r=a+t;r<50&&(r=50);for(var s=[],l=0,o=0;o<4;o++)s[o]=i*this.detailper[o]/100;var n=r-t;if(a>0){if(s[this.tddrager_disp+1]-n>50)s[this.tddrager_disp+1]-=n;else{var c=n+(s[this.tddrager_disp+1]-50);if(s[this.tddrager_disp+1]=50,this.tddrager_disp+1+1<4)if(s[this.tddrager_disp+1+1]-c>50)s[this.tddrager_disp+1+1]-=n;else{var d=c+(s[this.tddrager_disp+1+1]-50);s[this.tddrager_disp+1+1]=50,this.tddrager_disp+1+1+1<4&&(s[this.tddrager_disp+1+1+1]-d>50?s[this.tddrager_disp+1+1+1]-=n:s[this.tddrager_disp+1+1+1]=50)}}for(l=0,o=0;o<4;o++)o!==this.tddrager_disp&&(l+=s[o]);s[this.tddrager_disp]=i-l}else s[this.tddrager_disp]=r,s[this.tddrager_disp+1]-=n;for(l=0,o=0;o<4;o++)o!=this.tddrager_disp&&(l+=s[o]);for(s[this.tddrager_disp]=i-l,o=0;o<4;o++)this.detailper[o]=Math.floor(s[o]/i*100);this.showIcos(this.winid)},_filemanage.prototype.DetachEvent=function(){document.onmousemove=_filemanage.onmousemove,document.onmouseup=_filemanage.onmouseup,document.onselectstart=_filemanage.onselectstart},_filemanage.prototype.AttachEvent=function(e){_filemanage.onmousemove=document.onmousemove,_filemanage.onmouseup=document.onmouseup,_filemanage.onselectstart=document.onselectstart;try{document.onselectstart=function(){return!1},e.preventDefault?e.preventDefault():this.board.setCapture&&this.board.setCapture()}catch(e){}},_filemanage.prototype.Resize=function(){_explorer.Scroll(jQuery(".scroll-y"))},_filemanage.Search=function(e,a){var i={};for(var t in e)-1!==e[t].name.toLowerCase().indexOf(a.toLowerCase())&&(i[t]=e[t]);return i},_filemanage.Sort=function(e,a,i){var t=[];if(!e)return[];for(var r in e)switch(parseInt(a)){case 0:"folder"===e[r].type?t[t.length]=" "+e[r].name.replace(/_/g,"")+" ___"+r:t[t.length]=e[r].name.replace(/_/g,"")+"___"+r;break;case 1:t[t.length]=e[r].size+"___"+r;break;case 2:"folder"===e[r].type?t[t.length]=" ___"+r:t[t.length]=e[r].ext+e[r].type+"___"+r;break;case 3:t[t.length]=e[r].dateline+"___"+r}t=1===parseInt(a)?t.sort(function(e,a){return parseInt(e)-parseInt(a)}):t.sort();var s={},l="";if(i>0)for(r=0;r<t.length;r++)s["icos_"+(l=t[r].split("___"))[1]]=e[l[1]];else for(r=t.length-1;r>=0;r--)s["icos_"+(l=t[r].split("___"))[l.length-1]]=e[l[l.length-1]];return s},_filemanage.get_template=function(e,a,i,t){var r=_filemanage.cons[e],s="";if(a){switch(r.view){case 0:case 1:case 2:case 3:s=jQuery("#template_middleicon").html();break;case 4:s=jQuery("#template_detaillist").html()}s=s.replace(/\{asc_\d\}/g,r.asc);var l=new RegExp("{show_"+r.disp+"}","ig");s=(s=s.replace(l,"inline-block")).replace(/\{show_\d}/gi,"none")}else switch(r.view){case 0:case 1:case 2:case 3:s=jQuery("#template_middleicon .js-file-item-tpl").html();break;case 4:s=jQuery("#template_detaillist .js-file-item-tpl").html()}return s},_filemanage.property=function(e,a){var i="";if(a){var t=_explorer.sourcedata.folder[e];i=encodeURIComponent("fid_"+t.path)}else{var r=[],s=null;if(_filemanage.selectall.icos.length>0&&jQuery.inArray(e,_filemanage.selectall.icos)>-1)for(var l=0;l<_filemanage.selectall.icos.length;l++)s=_explorer.sourcedata.icos[_filemanage.selectall.icos[l]],r.push(s.dpath);else r=[(s=_explorer.sourcedata.icos[e]).dpath];i=encodeURIComponent(r.join(","))}showWindow("property",_explorer.appUrl+"&op=ajax&operation=property&paths="+i)},_filemanage.NewIco=function(e,a){(a||_filemanage.fid)&&(a||(a=_filemanage.fid),"newFolder"===e?showWindow("newFolder",_explorer.appUrl+"&op=ajax&operation="+e+"&fid="+a):"newLink"===e?showWindow("newLink",_explorer.appUrl+"&op=ajax&operation="+e+"&fid="+a):$.post(_explorer.appUrl+"&op=ajax&operation=newIco&type="+e,{fid:a},function(e){"success"===e.msg?(_explorer.sourcedata.icos[e.rid]=e,_filemanage.cons["f-"+a].CreateIcos(e),_filemanage.rename(e.rid)):showDialog(e.error)},"json"))},_filemanage.rename=function(e){if(_explorer.sourcedata.icos[e]){var a=_filemanage.cons[_filemanage.winid],i=jQuery("#file_text_"+e);i.css("overflow","visible"),i.closest("td").addClass("renaming"),jQuery("#Icoblock_middleicon_"+e).find(".IcoText_div").css("overflow","visible"),a.oldtext=i.html();var t="";t=a.view>3?"<input type='text' class='' name='text'  id='input_"+e+"' style=\"width:"+(i.closest("td").width()-110)+'px;height:30px;padding:2px; " value="'+a.oldtext+'">':"<textarea type='textarea' class='textarea' name='text'  id='input_"+e+'\' style="width:100%;height:30px;padding:2px;overflow:hidden;margin-top:3px;color:#666666 ">'+a.oldtext+"</textarea>",i.html(t);var r=jQuery("#input_"+e);r.select(),r.on("keyup",function(a){13===(a=a||event).keyCode&&jQuery(document).trigger("mousedown.file_text_"+e)}),jQuery(document).on("mousedown.file_text_"+e,function(t){var s=(t=t||window.event).srcElement?t.srcElement:t.target;if(jQuery(s).closest("#file_text_"+e).length<1){jQuery(document).off(".file_text_"+e);var l=r.val()||"";if(/^\s*$/.test(l))return showDialog(__lang.name_is_must,"error","",function(){i.html(a.oldtext),i.css("overflow","hidden"),i.closest("td").removeClass("renaming"),jQuery("#Icoblock_middleicon_"+e).find(".IcoText_div").css("overflow","hidden")}),!1;l=l.replace("\n",""),a.oldtext!==l?_filemanage.Rename(e,l):(i.html(a.oldtext),i.css("overflow","hidden"),i.closest("td").removeClass("renaming"),jQuery("#Icoblock_middleicon_"+e).find(".IcoText_div").css("overflow","hidden"))}})}},_filemanage.Rename=function(e,a){var i=_explorer.sourcedata.icos[e],t=_filemanage.cons[_filemanage.winid];jQuery.ajax({type:"post",url:_explorer.appUrl+"&op=dzzcp&do=rename",data:{text:a,path:i.dpath,t:(new Date).getTime()},dataType:"json",success:function(a){a.rid?(_explorer.sourcedata.icos[a.rid].name=a.name,t.data[a.rid].name=a.name,t.CreateIcos(_explorer.sourcedata.icos[a.rid],!0)):(jQuery("#file_text_"+e).html(t.oldtext),a.error&&showmessage(a.error,"danger",3e3,1))},error:function(){jQuery("#file_text_"+e).html(t.oldtext),json.error&&showmessage(json.error,"danger",3e3,1),showmessage(__lang.js_network_error,"danger",3e3,1)}})},_filemanage.showTemplatenoFile=function(e,a){a<1&&0==jQuery("#"+e).find(".emptyPage").length?jQuery(jQuery("#template_nofile_notice").html()).appendTo(jQuery("#"+e)):jQuery("#"+e).find(".emptyPage").remove()},_filemanage.delIco=function(e,a){var i=_filemanage.cons[_filemanage.winid],t="filemanage-"+_filemanage.winid,r=i.total;e||(e=_filemanage.selectall.icos[0]);var s=_explorer.sourcedata.icos[e];if(!a){return _filemanage.selectall.icos.length>0&&jQuery.inArray(e,_filemanage.selectall.icos)>-1?void(_explorer.sourcedata.icos[_filemanage.selectall.icos[0]].isdelete>0||_explorer.sourcedata.icos[_filemanage.selectall.icos[0]].bz&&_explorer.sourcedata.icos[_filemanage.selectall.icos[0]].bz?Confirm(__lang.js_delete_selectall,function(){_filemanage.delIco(e,1)}):Confirm(__lang.js_delete_selectall_recycle,function(){_filemanage.delIco(e,1)})):"folder"===_explorer.sourcedata.icos[e].type&&_explorer.sourcedata.folder[_explorer.sourcedata.icos[e].oid]&&_explorer.sourcedata.folder[_explorer.sourcedata.icos[e].oid].iconum?void(_explorer.sourcedata.icos[e].isdelete>0||_explorer.sourcedata.icos[e].bz&&_explorer.sourcedata.icos[e].bz?Confirm(__lang.js_delete_folder.replace("{name}",_explorer.sourcedata.icos[e].name),function(){_filemanage.delIco(e,1)}):Confirm(__lang.js_delete_folder_recycle.replace("{name}",_explorer.sourcedata.icos[e].name),function(){_filemanage.delIco(e,1)})):void(_explorer.sourcedata.icos[e].isdelete>0||_explorer.sourcedata.icos[e].bz&&_explorer.sourcedata.icos[e].bz?Confirm(__lang.js_delete_confirm.replace("{name}",_explorer.sourcedata.icos[e].name),function(){_filemanage.delIco(e,1)}):Confirm(__lang.js_delete_confirm_recycle.replace("{name}",_explorer.sourcedata.icos[e].name),function(){_filemanage.delIco(e,1)}))}var l=[],o={};if(_filemanage.selectall.icos.length>0&&jQuery.inArray(e,_filemanage.selectall.icos)>-1)if(s.bz&&s.bz){for(var n in _filemanage.selectall.icos)l.push(_explorer.sourcedata.icos[_filemanage.selectall.icos[n]].dpath);o={rids:l,bz:s.bz}}else{for(var n in _filemanage.selectall.icos)l.push(_explorer.sourcedata.icos[_filemanage.selectall.icos[n]].dpath);o={rids:l}}else o=s.bz&&s.bz?{rids:[s.dpath],bz:s.bz}:{rids:[s.dpath]};var c=_explorer.appUrl+"&op=dzzcp&do=deleteIco&t="+(new Date).getTime();showmessage("<p>"+__lang.deleting_not_please_close+'</p><div class="progress progress-striped active" style="margin:0"><div class="progress-bar" style="width:100%;"></div></div>',"success",0,1,"right-bottom"),jQuery.post(c,o,function(e){var a=[];for(var i in e.msg)"success"===e.msg[i]?(showmessage(_explorer.sourcedata.icos[i].name+__lang.delete_success,"success",1e3,1,"right-bottom"),a.push(i),r--,_filemanage.showTemplatenoFile(t,r)):showmessage(e.msg[i],"error",3e3,1,"right-bottom");_filemanage.removeridmore(a)},"json")};