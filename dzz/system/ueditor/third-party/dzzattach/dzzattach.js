dzzattach={},dzzattach.indzz=!!top._config,dzzattach.downurl=SITEURL+(DZZSCRIPT||"index.php")+"?mod=attach&op=down",dzzattach.previewurl=SITEURL+(DZZSCRIPT||"index.php")+"?mod=attach&op=preview",dzzattach.savetourl=SITEURL+(DZZSCRIPT||"index.php")+"?mod=attach&op=saveto",dzzattach.init=function(t){dzzattach.root=t,jQuery(t).find("a").each(function(){jQuery(this).attr("target")&&"_self"==jQuery(this).attr("target")||jQuery(this).attr("target","_blank")}),jQuery.getJSON(dzzattach.previewurl,function(e){dzzattach.exts=e,jQuery(t).find(".dzz-image").css({"max-width":"100%",width:"auto",height:"auto"}).on("click",function(){return this.id||(this.id="tip_"+Math.random()),dzzattach.preview(this.id,"image"),!1}),jQuery(t).find(".dzz-attach .dzz-attach-title").attr("target","_blank").on("mouseover",function(){var t=jQuery(this);this.id||(this.id="tip_"+Math.random());var e="";e+="<h5>"+t.attr("title")+" <small>("+t.attr("dsize")+")</small></h5>",e+='<div class="tip-op">',e+='<a class="preview" href="javascript:;" data-id="'+this.id+'" onclick="return dzzattach.preview(\''+this.id+"','attach')\" ><i class=\"dzz dzz-visibility dzzattach-i\"></i>"+__lang.preview+'</a><a class="download" href="javascript:;" data-id="'+this.id+'" onclick="return dzzattach.download(this);" ><i class="dzz dzz-download dzzattach-i"></i>'+__lang.download+"</a>",e+="</div>",hideMenu("","prompt"),showTip(this,"12",e)}).on("click",function(){return dzzattach.preview(this.id,"attach")}),jQuery(t).find(".dzz-link .dzz-link-title").attr("target","_blank").on("mouseover",function(){var t=jQuery(this);this.id||(this.id="tip_"+Math.random());var e="";e+="<h5>"+t.attr("title")+"</h5>",e+='<div class="tip-op">',e+='<a class="preview" href="javascript:;" data-id="'+this.id+'" onclick="return dzzattach.preview(\''+this.id+"','link')\" >"+__lang.preview+'</a><a class="saveto" href="javascript:;" data-id="'+this.id+'" onclick="return dzzattach.saveto(this,\'link\');" >'+__lang.js_saved_my_documents+"</a>",e+="</div>",hideMenu("","prompt"),showTip(this,"12",e)}).on("click",function(){return dzzattach.preview(this.id,"link")}),jQuery(t).find(".dzz-dzzdoc .dzz-dzzdoc-title").attr("target","_blank").on("mouseover",function(){var t=jQuery(this);this.id||(this.id="tip_"+Math.random());var e="";e+="<h5>"+t.attr("title")+"</h5>",e+='<div class="tip-op">',e+='<a class="preview" href="javascript:;" data-id="'+this.id+'" onclick="return dzzattach.preview(\''+this.id+"','dzzdoc')\" >"+__lang.preview+'</a><a class="saveto" href="javascript:;" data-id="'+this.id+'" onclick="return dzzattach.saveto(this,\'dzzdoc\');" >'+__lang.js_saved_my_documents+"</a>",e+="</div>",hideMenu("","prompt"),showTip(this,"12",e)}).on("click",function(){return dzzattach.preview(this.id,"dzzdoc")})})},dzzattach.preview=function(t,e){var a=document.getElementById(t);if(!a)return!1;var i=jQuery(a),n=i.attr("ext");switch(e){case"attach":var r=SITEURL+"share.php?a=view&s="+i.attr("apath");if(dzzattach.indzz)try{top.OpenWindow("preview_"+i.attr("aid"),r,d.title,d.feature||"",{name:d.title,img:d.icon})}catch(t){window.open(r)}else window.open(r);break;case"link":if(n||(n="link"),n&&dzzattach.exts[n])(d=dzzattach.exts[n]).title=i.attr("title"),d.icon=i.parent().find(".dzz-link-icon").attr("src"),-1!==(r=d.url).indexOf("dzzjs:")&&-1!==r.indexOf("window.open")?window.open(i.attr("href")):dzzattach.indzz?top.OpenWindow("preview_"+encodeURIComponent(i.attr("href")).replace(/\./g,"_").replace(/%/g,"_"),i.attr("href"),d.title,"",{name:d.title,img:d.icon}):window.open(i.attr("href"));else dzzattach.indzz?top.OpenWindow("preview_"+encodeURIComponent(i.attr("href")).replace(/\./g,"_").replace(/%/g,"_"),i.attr("href"),d.title,"",{name:d.title,img:d.icon}):window.open(i.attr("href"));break;case"dzzdoc":var d;(d=dzzattach.exts[n]||{}).title=i.attr("title"),d.icon=i.parent().find(".dzz-dzzdoc-icon").attr("src");r=d.url;dzzattach.indzz?top.OpenWindow("preview_"+encodeURIComponent(i.attr("href")).replace(/\./g,"_").replace(/%/g,"_"),i.attr("href"),d.title,"",{name:d.title,img:d.icon}):window.open(i.attr("href"));break;case"image":dzzattach.thumb(t);break;default:dzzattach.indzz?top.OpenWindow("preview_"+encodeURIComponent(i.attr("href")).replace(/\./g,"_").replace(/%/g,"_"),r,i.attr("title"),"",{name:i.attr("title")}):window.open(i.attr("href"))}return!1},dzzattach.download=function(t,e){if("image"==e)var a=jQuery(t);else{var i=document.getElementById(jQuery(t).data("id"));if(!i)return!1;a=jQuery(i)}var n=dzzattach.downurl+"&path="+a.attr("apath")+"&filename="+encodeURI(a.attr("title")?a.attr("title"):a.attr("alt"));document.getElementById("hideframe")||jQuery('<iframe id="hideframe" name="hideframe" src="about:blank" frameborder="0" marginheight="0" marginwidth="0" width="0" height="0" allowtransparency="true" style="display:none;z-index:-99999"></iframe>').appendTo("body"),jQuery("#hideframe").attr("src",n)},dzzattach.saveto=function(t,e){if("image"==e)var a=jQuery(t);else{var i=document.getElementById(jQuery(t).data("id"));if(!i)return!1;a=jQuery(i)}if("link"==e)var n=dzzattach.savetourl+"&type=link&link="+encodeURIComponent(a.attr("href"))+"&filename="+encodeURI(a.attr("title")?a.attr("title"):a.attr("alt"));else if("dzzdoc"==e)n=dzzattach.savetourl+"&type=dzzdoc&aid="+a.attr("aid")+"&filename="+encodeURI(a.attr("title"));else if("image"==e)n=dzzattach.savetourl+"&type=image&aid="+a.attr("aid")+"&filename="+encodeURI(a.attr("alt"));else n=dzzattach.savetourl+"&type=attach&aid="+a.attr("aid")+"&filename="+encodeURI(a.attr("title"));document.getElementById("hideframe")||jQuery('<iframe id="hideframe" name="hideframe" src="about:blank" frameborder="0" marginheight="0" marginwidth="0" width="0" height="0" allowtransparency="true" style="display:none;z-index:-99999"></iframe>').appendTo("body"),jQuery("#hideframe").attr("src",n)},dzzattach.thumb={},dzzattach.thumb=function(t){dzzattach.thumb.datas=[],dzzattach.thumb.current=0,jQuery(dzzattach.root).find(".dzz-image").each(function(e){document.getElementById(t).src==this.src&&(dzzattach.thumb.current=e),dzzattach.thumb.datas.push({ele:this,src:this.src,title:this.alt})});var e;e="",e+='<div id="preview_Container" class="modal fade" style="position:fixed;width:100%;height:100%;top:0px;left:0px;bottom:0px;right:0px;display:none;z-index:90000">',e+='<div id="preview-box" class="preview-box">',e+='\t<div class="preview-handle" style="z-index: 118;"><b data_title="ESC'+__lang.logout+'" btn="close" class="pr-close" onclick="dzzattach.thumb.btnClick(\'close\');">ESC'+__lang.logout+"</b></div>",e+='\t<div id="btn_hand" class="preview-panel" style="z-index: 117;">',e+='\t\t<ul id="contents-panel" style="right:55px;" class="contents-panel">',e+='\t\t\t<li btn="rotate"  onclick="dzzattach.thumb.btnClick(\'rotate\');"><i class="pr-rotate"></i><b>'+__lang.rotation+"</b></li>",e+='\t\t\t<li class="hidden-xs"  btn="download" onclick="dzzattach.thumb.btnClick(\'download\');"><i class="pr-download"></i><b>'+__lang.download+"</b></li>",e+='\t\t\t<li btn="newwindow"   onclick="dzzattach.thumb.btnClick(\'newwindow\');"><i class="pr-newwindow"></i><b>'+__lang.look_artwork+"</b></li>",e+="\t\t</ul>",e+='\t\t<div id="file_name" class="previewer-filename hidden-xs"></div>',e+="\t</div>",e+='\t<div id="con" class="preview-contents">',e+='\t\t<div class="pr-btn-switch">',e+='\t\t\t<b data_title="'+__lang.keyboard+"“←”"+__lang.key_on+'" btn="prev" class="pr-btn-prev" style="z-index: 116;" onclick="dzzattach.thumb.btnClick(\'prev\');">'+__lang.on_a+"</b>",e+='\t\t\t<b data_title="'+__lang.keyboard+"“→”"+__lang.key_under+'" btn="next" class="pr-btn-next" style="z-index: 116;" onclick="dzzattach.thumb.btnClick(\'next\');">'+__lang.under_a+"</b>",e+="\t\t</div>",e+='\t\t<div id="pre_loading" style="display: none;" class="previewer-loading">'+__lang.loading_in+"</div>",e+='\t\t<div id="previewer-photo" class="previewer-photo" style="overflow: visible; z-index: 114; display: none; left: 0px; top: 40px;background-color: rgba(0,0,0,.5);" onclick="dzzattach.thumb.btnClick(\'close\');"></div>',e+="\t</div>",e+="</div>",e+='<div id="prev-tips" class="prev-tips" >'+__lang.keyboard+"“←”"+__lang.key_on+"</div>",e+='<div id="next-tips" class="next-tips">'+__lang.keyboard+"“→”"+__lang.key_under+"</div>",e+='<div id="close-tips" class="esc-tips">ESC'+__lang.logout+"</div>",e+='<div id="popup-hint" style="z-index: 999999999; top: 50%; left:50%;margin-left:-86px; display:none;" class="popup-hint">',e+='\t<i rel="type" class="hint-icon hint-inf-m"></i>',e+='\t<em class="sl"><b></b></em>',e+='\t<span rel="con">'+__lang.has_last_picture1+"</span>",e+='\t<em class="sr"><b></b></em>',e+="</div>",e+="</div>",jQuery(e).appendTo(document.body),jQuery("body").addClass("dzzthumb_body"),jQuery("#preview_Container").css({height:"100%",width:"100%"}).show(),jQuery("#preview-box b").on("mouseenter",function(){var t=jQuery(this).attr("btn");jQuery("#"+t+"-tips").show()}),jQuery("#preview-box b").on("mouseleave",function(){var t=jQuery(this).attr("btn");jQuery("#"+t+"-tips").hide()}),jQuery(document).on("keyup.preview",function(t){var e;switch(""!=t.which?e=t.which:""!=t.charCode?e=t.charCode:""!=t.keyCode&&(e=t.keyCode),e){case 27:dzzattach.thumb.btnClick("close");break;case 37:dzzattach.thumb.btnClick("prev");break;case 39:dzzattach.thumb.btnClick("next")}}),dzzattach.showContent()},dzzattach.showContent=function(){var t=dzzattach.thumb.datas[dzzattach.thumb.current];if(t){jQuery("#file_name").html(t.title),jQuery("#popup-hint").hide(),jQuery("#previewer-photo").empty().hide(),jQuery("#pre_loading").show();var e=jQuery("#previewer-photo"),a=Math.max(document.documentElement.clientWidth,document.body.offsetWidth),i=Math.max(document.documentElement.clientHeight,document.body.offsetHeight);dzzattach.imgReady(t.src,function(){var n=0,r=0,d=1*this.width,o=1*this.height,c=a-6,h=i-jQuery("#btn_hand").height()-6,l=d/o;c/h>l?h<o?(r=h,n=d/o*h):(n=d,r=o):c<d?(n=c,r=o/d*c):(n=d,r=o);var s=jQuery('<img height="'+r+'" width="'+n+'" style="cursor: move; top: '+(h-r)/2+"px; transform: rotate(0deg); left: "+(a-n)/2+'px;" src="'+t.src+'" ws_property="1" onload="jQuery(\'#pre_loading\').fadeOut();jQuery(\'#previewer-photo\').show();" >').appendTo(e);s.get(0).onmousedown=function(t){try{dragMenu(s.get(0),t,1)}catch(t){}},s.on("click",function(){return!1}),jQuery.getScript("static/js/jquery.mousewheel.js",function(t){s.on("mousewheel",function(t,e,a,i){var n=100*e,r=n*l;return dzzattach.thumb.pic_resize(r,n),!1})})})}},dzzattach.thumb.angle=0,dzzattach.thumb.pic_resize=function(t,e){var a=jQuery("#previewer-photo>img"),i=a.position(),n=i.left,r=i.top,d=a.width(),o=a.height();n-=t/2,r-=e/2,d+=t,o+=e,a.css({left:n,top:r,width:d,height:o,"max-width":"none"})},dzzattach.thumb.btnClick=function(t){switch(t){case"close":jQuery(document).off(".preview"),jQuery("body").removeClass("dzzthumb_body"),jQuery("#preview_Container").remove(),jQuery("#previewr-photo").empty();break;case"prev":0==dzzattach.thumb.current?(jQuery("#popup-hint").find("span").html(__lang.has_last_picture),jQuery("#popup-hint").show(),window.setTimeout(function(){jQuery("#popup-hint").hide()},3e3)):(dzzattach.thumb.current=dzzattach.thumb.current-1,dzzattach.showContent());break;case"next":dzzattach.thumb.current==dzzattach.thumb.datas.length-1?(jQuery("#popup-hint").find("span").html(__lang.has_last_picture1),jQuery("#popup-hint").show(),window.setTimeout(function(){jQuery("#popup-hint").hide()},3e3)):(dzzattach.thumb.current=dzzattach.thumb.current+1,dzzattach.showContent());break;case"download":var e=dzzattach.thumb.datas[dzzattach.thumb.current];dzzattach.download(e.ele,"image");break;case"newwindow":(e=dzzattach.thumb.datas[dzzattach.thumb.current]).src&&window.open(e.src);break;case"rotate":var a=jQuery("#previewer-photo img");dzzattach.thumb.angle+=90;var i=dzzattach.thumb.angle%360/90;a.css({transform:"rotate("+dzzattach.thumb.angle+"deg)","-webkit-transform":"rotate("+dzzattach.thumb.angle+"deg)","-moz-transform":"rotate("+dzzattach.thumb.angle+"deg)","-o-transform":"rotate("+dzzattach.thumb.angle+"deg)","-ms-transform":"rotate("+dzzattach.thumb.angle+"deg)"}),BROWSER.ie&&BROWSER.ie<9&&a.css("filter","progid:DXImageTransform.Microsoft.BasicImage(Rotation="+i+"))");break;case"collect":e=dzzattach.thumb.datas[dzzattach.thumb.current];dzzattach.saveto(e.ele,"image")}},dzzattach.imgReady=function(){var t=[],e=null,a=function(){for(var e=0;e<t.length;e++)t[e].end?t.splice(e--,1):t[e]();!t.length&&i()},i=function(){clearInterval(e),e=null};return function(i,n,r,d){var o,c,h,l,s,z=new Image;if(z.src=i,z.complete)return n.call(z),void(r&&r.call(z));c=z.width,h=z.height,z.onerror=function(){d&&d.call(z),o.end=!0,z=z.onload=z.onerror=null},(o=function(){l=z.width,s=z.height,(l!==c||s!==h||l*s>1024)&&(n.call(z),o.end=!0)})(),z.onload=function(){!o.end&&o(),r&&r.call(z),z=z.onload=z.onerror=null},o.end||(t.push(o),null===e&&(e=setInterval(a,40)))}}();