!function(t){"use strict";var e=function(e,i){this.$element=t(e),this.options=t.extend(!0,{},t.fn.typeahead.defaults,i),this.$menu=t(this.options.menu).appendTo(this.$element.parent()),this.shown=!1,this.eventSupported=this.options.eventSupported||this.eventSupported,this.grepper=this.options.grepper||this.grepper,this.highlighter=this.options.highlighter||this.highlighter,this.lookup=this.options.lookup||this.lookup,this.matcher=this.options.matcher||this.matcher,this.render=this.options.render||this.render,this.select=this.options.select||this.select,this.sorter=this.options.sorter||this.sorter,this.source=this.options.source||this.source,this.inputval=this.options.taginput||null;var s=this.options.ajax;this.ajax="string"==typeof s?t.extend({},t.fn.typeahead.defaults.ajax,{url:s}):t.extend({},t.fn.typeahead.defaults.ajax,s),this.ajax.url||(this.ajax=null),this.listen()};e.prototype={constructor:e,eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},ajaxer:function(){var e=this,i=e.$element.val();if(i===e.query){this.ajax.preProcess&&(data=this.ajax.preProcess(this.ajax.data));var s=this.grepper(this.ajax.data);return s&&s.length?this.render(s.slice(0,this.options.items)).show():this.shown?this.hide():this}return e.query=i,e.ajax.timerId&&(clearTimeout(e.ajax.timerId),e.ajax.timerId=null),i.length<e.ajax.triggerLength?(e.ajax.xhr&&(e.ajax.xhr.abort(),e.ajax.xhr=null,e.ajaxToggleLoadClass(!1)),e.shown?e.hide():e):(e.ajax.timerId=setTimeout(function(){t.proxy(e.ajaxExecute(i),e)},e.ajax.timeout),e)},ajaxExecute:function(e){this.ajaxToggleLoadClass(!0),this.ajax.xhr&&this.ajax.xhr.abort();var i=this.ajax.preDispatch?this.ajax.preDispatch(e):{query:e},s="post"===this.ajax.method?t.post:t.get;this.ajax.xhr=s(this.ajax.url,i,t.proxy(this.ajaxLookup,this),"json"),this.ajax.timerId=null},ajaxLookup:function(t){var e;if(this.ajaxToggleLoadClass(!1),this.ajax.xhr)return this.ajax.preProcess&&(t=this.ajax.preProcess(t)),this.ajax.data=t,(e=this.grepper(this.ajax.data))&&e.length?(this.ajax.xhr=null,this.render(e.slice(0,this.options.items)).show()):this.shown?this.hide():this},ajaxToggleLoadClass:function(t){this.ajax.loadingClass&&this.$element.toggleClass(this.ajax.loadingClass,t)},lookup:function(t){var e;if(!this.ajax)return this.query=this.$element.val(),this.query,(e=this.grepper(this.source))&&e.length?this.render(e.slice(0,this.options.items)).show():this.shown?this.hide():this;this.ajaxer()},grepper:function(e){var i,s=this;return e&&e.length&&!e[0].hasOwnProperty(s.options.display)?null:(i=t.grep(e,function(t){return s.matcher(t[s.options.display],t)}),this.sorter(i))},matcher:function(e){if(this.inputval){var i=this.inputval.val().split(",");if(t.inArray(e,i)>-1)return 0}return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(t){for(var e,i=[],s=[],a=[];e=t.shift();)e[this.options.display].toLowerCase().indexOf(this.query.toLowerCase())?~e[this.options.display].indexOf(this.query)?s.push(e):a.push(e):i.push(e);return i.concat(s,a)},show:function(){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:e.top+e.height,left:e.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},highlighter:function(t){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(new RegExp("("+e+")","ig"),function(t,e){return"<strong>"+e+"</strong>"})},render:function(e){var i=this;return(e=t(e).map(function(e,s){return(e=t(i.options.item).attr("data-value",s[i.options.val])).find("a").html(i.highlighter(s[i.options.display],s)),e[0]})).first().addClass("active"),this.$menu.html(e),this},select:function(){var t=this.$menu.find(".active");return this.$element.val(t.text()).trigger("change"),this.options.itemSelected(t,t.attr("data-value"),t.text()),this.hide()},next:function(e){var i=this.$menu.find(".active").removeClass("active").next();i.length||(i=t(this.$menu.find("li")[0])),i.addClass("active")},prev:function(t){var e=this.$menu.find(".active").removeClass("active").prev();e.length||(e=this.$menu.find("li").last()),e.addClass("active")},listen:function(){this.$element.on("blur",t.proxy(this.blur,this)).on("keyup",t.proxy(this.keyup,this)).on("click",t.proxy(this.lookup,this)),this.eventSupported("keydown")?this.$element.on("keydown",t.proxy(this.keypress,this)):this.$element.on("keypress",t.proxy(this.keypress,this)),this.$menu.on("click",t.proxy(this.click,this)).end().on("mouseenter","li",t.proxy(this.mouseenter,this))},keyup:function(t){switch(t.stopPropagation(),t.preventDefault(),t.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:this.hide();break;default:this.lookup()}},keypress:function(t){if(t.stopPropagation(),this.shown)switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}},blur:function(t){var e=this;t.stopPropagation(),t.preventDefault(),setTimeout(function(){e.$menu.is(":focus")||e.hide()},150)},click:function(t){t.stopPropagation(),t.preventDefault(),this.select()},mouseenter:function(e){this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")}},t.fn.typeahead=function(i){return this.each(function(){var s=t(this),a=s.data("typeahead"),n="object"==typeof i&&i;a||s.data("typeahead",a=new e(this,n)),"string"==typeof i&&a[i]()})},t.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',display:"name",val:"id",itemSelected:function(t,e,i){},ajax:{url:null,timeout:300,method:"post",triggerLength:3,loadingClass:null,displayField:null,preDispatch:null,preProcess:null}},t.fn.typeahead.Constructor=e,t(function(){t("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var i=t(this);i.data("typeahead")||(e.preventDefault(),i.typeahead(i.data()))})})}(window.jQuery);