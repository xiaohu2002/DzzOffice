/*
 * @copyright   Leyun internet Technology(Shanghai)Co.,Ltd
 * @license     http://www.dzzoffice.com/licenses/license.txt
 * @package     DzzOffice
 * @link        http://www.dzzoffice.com
 * @author      zyx(zyx@dzz.cc)
 */
var profileTips=__lang.js_change_password;function errormessage(e,a,n){e.length&&((a=a||"")?e.parent().find(".help-msg").removeClass("chk_right"):e.parent().find(".help-msg").addClass("chk_right"),e.parent().find(".help-msg").html(a),a&&!n?e.parent().addClass("has-error"):e.closest(".has-error").removeClass("has-error"))}function addFormEvent(e,a){jQuery("#username").on("blur keyup",function(){""==this.value?errormessage(jQuery(this),__lang.username_character):checkusername(jQuery(this))}),jQuery("#email").on("blur keyup",function(){""==this.value?errormessage(jQuery(this),__lang.register_email_tips1):checkemail(jQuery(this))}),checkPwdComplexity(document.getElementById("password"),document.getElementById("password2")),a&&jQuery("#"+e+" .form-control").first().focus()}function checkPwdComplexity(e,a,n){modifypwd=n||!1;var r=jQuery(e),i=jQuery(a);r.on("blur",function(){if(""==r.val()){var e=modifypwd?profileTips:__lang.profile_passwd_illegal;pwlength>0&&(e+=", "+__lang.register_password_length_tips1+pwlength+" "+__lang.register_password_length_tips2),n||errormessage(r,e)}else errormessage(r,modifypwd?profileTips:"");checkpassword(r,i)}),r.on("keyup",function(){if(0==pwlength||r.val().length>=pwlength){var e=new Array("",__lang.weak,__lang.center,__lang.strong),a=checkstrongpw(r);errormessage(r,'<span class="passlevel passlevel'+a+'">'+__lang.intension+":"+e[a]+"</span>","passlevel")}}),i.on("blur keyup",function(){""==i.val()&&(n||errormessage(i,modifypwd?profileTips:__lang.register_repassword_tips)),checkpassword(r,i)})}function checkstrongpw(e){var a=0,n=e.val();return n&&n.match(/\d+/g)&&a++,n&&n.match(/[a-z]+/gi)&&a++,n&&n.match(/[^a-z0-9]+/gi)&&a++,a}function showbirthday(){var e=document.getElementById("birthday"),a=e.value;e.length=0,e.options.add(new Option("日",""));for(var n=0;n<28;n++)e.options.add(new Option(n+1,n+1));if("2"!=document.getElementById("birthmonth").value)switch(e.options.add(new Option(29,29)),e.options.add(new Option(30,30)),document.getElementById("birthmonth").value){case"1":case"3":case"5":case"7":case"8":case"10":case"12":e.options.add(new Option(31,31))}else if(""!=document.getElementById("birthyear").value){var r=document.getElementById("birthyear").value;(r%400==0||r%4==0&&r%100!=0)&&e.options.add(new Option(29,29))}e.value=a}function trim(e){return e.replace(/^\s*(.*?)[\s\n]*$/g,"$1")}function checksubmit(e){var a=jQuery("#registerform").find(".has-error");if(a.length>0)return a.first().find("input").focus(),!1;ajaxpost("registerform","returnmessage4","returnmessage4")}function check_submit(e){var a=0;if(jQuery(e).find(".help-msg").each(function(){if(!jQuery(this).hasClass("chk_right"))return jQuery(this).parent().find("input").trigger("blur").focus(),a=1,!1}),a)return!1;var n=jQuery(e).attr("action");n=n||"user.php?mod=register";jQuery.post(n+"&returnType=json",jQuery(e).serialize(),function(e){e.success?location.href=e.success.url_forward:jQuery("#returnmessage4").html(e.error)},"json")}function checkusername(e){var a=trim(e.val());if(""!=a&&a!=lastusername){if(a.match(/<|\"/gi))errormessage(e,__lang.profile_nickname_illegal);else if(a){var n=a.replace(/[^\x00-\xff]/g,"**").length;if(n<3||n>30)return void errormessage(e,__lang.username_character);jQuery.getJSON("user.php?mod=ajax&action=checkusername&username="+encodeURI(a),function(a){errormessage(e,a.error||"")})}}else errormessage(e)}function checkpassword(e,a){if(e.val()||a.val())if(pwlength>0&&e.val().length<pwlength)errormessage(e,__lang.password_too_short+" "+pwlength+" "+__lang.register_password_length_tips2);else{if(strongpw){var n=!1,r=0,i=new Array;for(var s in strongpw)1!==strongpw[s]||e.val().match(/\d+/g)||(n=!0,i[r]=__lang.strongpw_1,r++),2!==strongpw[s]||e.val().match(/[a-z]+/g)||(n=!0,i[r]=__lang.strongpw_2,r++),3!==strongpw[s]||e.val().match(/[A-Z]+/g)||(n=!0,i[r]=__lang.strongpw_3,r++),4!==strongpw[s]||e.val().match(/[^A-Za-z0-9]+/g)||(n=!0,i[r]=__lang.strongpw_4,r++);if(n)return void errormessage(e,__lang.password_weak+" "+i.join("，"))}errormessage(a),e.val()!=a.val()?errormessage(a,__lang.profile_passwd_notmatch):errormessage(a,modifypwd?profileTips:"")}}function checkemail(e){var a=trim(e.val());if(""!=a&&a!=lastemail)if(a.match(/<|\"/gi))errormessage(e,__lang.Email_sensitivity);else{/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a)?jQuery.getJSON("user.php?mod=ajax&action=checkemail&email="+a,function(a){errormessage(e,a.error||"")}):errormessage(e,__lang.email_illegal)}else errormessage(e)}function addMailEvent(e){e.onclick=function(a){emailMenu(a,e.id)},e.onkeyup=function(a){emailMenu(a,e.id)},e.onkeydown=function(a){emailMenuOp(4,a,e.id)},e.onblur=function(){""==e.value&&errormessage(e.id,__lang.register_email_tips1),emailMenuOp(3,null,e.id)},stmp.email=e.id}var emailMenuST=null,emailMenui=0,emaildomains=["qq.com","163.com","126.com","sina.com","sohu.com","yahoo.com","gmail.com","hotmail.com"];function emailMenuOp(e,a,n){if(3==e&&BROWSER.ie&&BROWSER.ie<7&&checkemail(n),$("emailmore_menu"))if(1==e)$("emailmore_menu").style.display="none";else if(2==e)showMenu({ctrlid:"emailmore",pos:"13!"});else if(3==e)emailMenuST=setTimeout(function(){emailMenuOp(1,n),checkemail(n)},500);else if(4==e){a=a||window.event;var r=$(n);if(13==a.keyCode){var s=-1!=r.value.indexOf("@")?r.value.substring(0,r.value.indexOf("@")):r.value;r.value=s+"@"+emaildomains[emailMenui],doane(a)}}else if(5==e){var l=$("emailmore_menu").getElementsByTagName("a");for(i=0;i<l.length;i++)l[i].className=""}}function emailMenu(e,a){if(!(BROWSER.ie&&BROWSER.ie<7)){e=e||window.event;var n=$(a);if(-1==n.value.indexOf("@")){var r=e.keyCode,i=n.value;if(n.value.length){if(40==r)++emailMenui>=emaildomains.length&&(emailMenui=0);else if(38==r)--emailMenui<0&&(emailMenui=emaildomains.length-1);else if(13==r)return void($("emailmore_menu").style.display="none");$("emailmore_menu")||(menu=document.createElement("div"),menu.id="emailmore_menu",menu.style.display="none",menu.className="p_pop",menu.setAttribute("disautofocus",!0),$("append_parent").appendChild(menu));for(var s='<ul class="dropdown-menu" style="display:block">',l=0;l<emaildomains.length;l++)s+='<li><a href="javascript:;" onmouseover="emailMenuOp(5)" '+(emailMenui==l?'class="a" ':"")+"onclick=\"$(stmp['email']).value=this.innerHTML;display('emailmore_menu');checkemail(stmp['email']);\">"+i+"@"+emaildomains[l]+"</a></li>";s+="</ul>",$("emailmore_menu").innerHTML=s,emailMenuOp(2)}else emailMenuOp(1)}else $("emailmore_menu")&&($("emailmore_menu").style.display="none")}}